## 1. 优化思路

### 1.1 影响 SQL 语句执行效率的主要因素

**数据量**

- SQL 执行后返回给客户端的数量大小
- 数据量越大需要扫描的 I/O 次数越多，数据库服务器的 IO 更容易成为瓶颈

**取数据的方式**

- 数据在缓存中还是在磁盘上
- 是否能够通过全局索引快速寻址
- 是否结合谓词条件命中全局索引加速扫描

**数据加工的方式**

- 排序、子查询、聚合、关联等，一般需要先把数据取到临时表中，再对数据进行加工
- 对于数据量比较多的计算，会消耗大量计算节点的 CPU 资源，让数据加工变得更加缓慢
- 是否选择了合适的 join 方式

<br>

### 1.2 优化思路

**减少数据扫描（减少磁盘访问）**

- 尽量在查询中加入一些可以提前过滤数据的谓词条件，比如按照时间过滤数据等，可以减少数据的扫描量，对查询更友好（提前过滤数据）
- 在扫描大表数据时是否可以命中索引，减少回表代价，避免全表扫描（命中索引）

**减少交互次数（减少网络传输）**

- 将数据存放在更快的地方
- 某条查询涉及到大表，无法进一步优化，如果返回的数据量不大且变化频率不高但访问频率很高，此时应该考虑将返回的数据放在应用端的缓存当中或者 Redis 这样的缓存当中，以提高存取速度

**返回更少数据**：减少网络传输

**减少服务器 CPU 开销**：减少 CPU 及内存开销

**避免大事务操作**

**利用更多资源**：增加资源

<br>

## 2. 优化案例

参考：https://mp.weixin.qq.com/s/CaSVhAJgycjjbCxAkII2ZA

**将数据分页优化**：偏移 id、分段查询





















